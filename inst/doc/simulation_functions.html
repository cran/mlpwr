<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>simulation_functions</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">simulation_functions</h1>



<p>We present examples of setting up a simulation function for various
models and R packages. These are written in a basic way to serve as
blueprints for further customization.</p>
<p>The general layout of a simulation function is:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>simfun <span class="ot">&lt;-</span> <span class="cf">function</span>(N) {</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>    <span class="co"># Generate a data set Test the hypothesis</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>}</span></code></pre></div>
<p>For all examples in this vignette, we use an alpha level of .01 and a
desired power of .95.</p>
<p>For further guidance on how to use the package and the
<code>find.design</code> function specifically, see the <a href="https://github.com/flxzimmer/mlpwr">Readme.md file</a></p>
<div id="t-test" class="section level1">
<h1>T-Test</h1>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">library</span>(mlpwr)</span></code></pre></div>
<p>We test for one sample whether the mean differs from 0. The true
effect size is Cohen’s d = .3. In this scenario, this means that the
true mean difference is .3.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>simfun_ttest <span class="ot">&lt;-</span> <span class="cf">function</span>(N) {</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>    <span class="co"># Generate a data set</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>    dat <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> N, <span class="at">mean =</span> <span class="fl">0.3</span>)</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>    <span class="co"># Test the hypothesis</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">t.test</span>(dat)</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>    res<span class="sc">$</span>p.value <span class="sc">&lt;</span> <span class="fl">0.01</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>}</span></code></pre></div>
<p>Example Use. The boundaries for the sample size are set to 100 and
300 for the lower and upper boundaries, respectively. The desired power
is set to .95.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">find.design</span>(<span class="at">simfun =</span> simfun_ttest, <span class="at">boundaries =</span> <span class="fu">c</span>(<span class="dv">100</span>,</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>    <span class="dv">300</span>), <span class="at">power =</span> <span class="fl">0.95</span>)</span></code></pre></div>
</div>
<div id="anova" class="section level1">
<h1>ANOVA</h1>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">library</span>(mlpwr)</span></code></pre></div>
<p>We test for a mean difference among <code>n.groups</code> groups.
Each group consists of <code>n</code> participants.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>simfun_anova <span class="ot">&lt;-</span> <span class="cf">function</span>(n, n.groups) {</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>    <span class="co"># Generate a data set</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>    groupmeans <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n.groups, <span class="at">sd =</span> <span class="fl">0.2</span>)  <span class="co"># generate groupmeans using cohen&#39;s f=.2</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>    dat <span class="ot">&lt;-</span> <span class="fu">sapply</span>(groupmeans, <span class="cf">function</span>(x) <span class="fu">rnorm</span>(n,</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>        <span class="at">mean =</span> x, <span class="at">sd =</span> <span class="dv">1</span>))  <span class="co"># generate data</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>    dat <span class="ot">&lt;-</span> dat <span class="sc">|&gt;</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>        <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>        <span class="fu">gather</span>()  <span class="co"># format</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>    <span class="co"># Test the hypothesis</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">aov</span>(value <span class="sc">~</span> key, <span class="at">data =</span> dat)  <span class="co"># perform ANOVA</span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a>    <span class="fu">summary</span>(res)[[<span class="dv">1</span>]][<span class="dv">1</span>, <span class="dv">5</span>] <span class="sc">&lt;</span> <span class="fl">0.01</span>  <span class="co"># extract significance</span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a>}</span></code></pre></div>
<p>Example Use. The boundaries are defined as a list here to account for
the multidimensional set of design parameters. Also, we define a cost
function to enable differentiating designs with equal power.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">find.design</span>(<span class="at">simfun =</span> simfun_anova, <span class="at">costfun =</span> <span class="cf">function</span>(n,</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>    n.groups) <span class="dv">5</span> <span class="sc">*</span> n <span class="sc">+</span> <span class="dv">20</span> <span class="sc">*</span> n.groups, <span class="at">boundaries =</span> <span class="fu">list</span>(<span class="at">n =</span> <span class="fu">c</span>(<span class="dv">10</span>,</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>    <span class="dv">150</span>), <span class="at">n.groups =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">30</span>)), <span class="at">power =</span> <span class="fl">0.95</span>)</span></code></pre></div>
</div>
<div id="generalized-linear-models" class="section level1">
<h1>Generalized Linear Models</h1>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">library</span>(mlpwr)</span></code></pre></div>
<p>We consider generalized linear models using the <code>stats</code>
package and the <code>glm</code> function.</p>
<div id="using-a-fitted-model" class="section level2">
<h2>Using a fitted model</h2>
<p>We use an “original” data set and fit a generalized linear model
assuming a Poisson distributed criterion <code>counts</code>. Here,
<code>counts</code> is the criterion, <code>treatment</code> and
<code>outcome</code> are the predictors.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>dat.original <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">counts =</span> <span class="fu">c</span>(<span class="dv">18</span>, <span class="dv">17</span>, <span class="dv">15</span>, <span class="dv">20</span>,</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>    <span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">13</span>, <span class="dv">12</span>), <span class="at">treatment =</span> <span class="fu">gl</span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">9</span>), <span class="at">outcome =</span> <span class="fu">gl</span>(<span class="dv">3</span>,</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>    <span class="dv">3</span>))</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>mod.original <span class="ot">&lt;-</span> <span class="fu">glm</span>(counts <span class="sc">~</span> outcome <span class="sc">+</span> treatment, <span class="at">data =</span> dat.original,</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>    <span class="at">family =</span> poisson)  <span class="co"># setting up the generalized linear model</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="fu">summary</span>(mod.original)</span></code></pre></div>
<p>We use the parameters from the original model in the
<code>simfun</code>.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>simfun_glm1 <span class="ot">&lt;-</span> <span class="cf">function</span>(N) {</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>    <span class="co"># generate data</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>    dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">outcome =</span> <span class="fu">gl</span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="fu">ceiling</span>(N<span class="sc">/</span><span class="dv">3</span>)),</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>        <span class="at">treatment =</span> <span class="fu">gl</span>(<span class="dv">3</span>, <span class="fu">ceiling</span>(N<span class="sc">/</span><span class="dv">3</span>)))[<span class="dv">1</span><span class="sc">:</span>N, ]  <span class="co"># predictors </span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>    a <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod.original, <span class="at">newdata =</span> dat, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)  <span class="co"># criterion &#39;raw&#39;</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>    dat<span class="sc">$</span>counts <span class="ot">&lt;-</span> <span class="fu">rpois</span>(N, a)  <span class="co"># criterion applying poisson distribution</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>    <span class="co"># test hypothesis</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a>    mod <span class="ot">&lt;-</span> <span class="fu">glm</span>(counts <span class="sc">~</span> outcome <span class="sc">+</span> treatment, <span class="at">data =</span> dat,</span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a>        <span class="at">family =</span> poisson)  <span class="co"># fit a glm</span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a>    <span class="fu">summary</span>(mod)<span class="sc">$</span>coefficients[<span class="st">&quot;treatment2&quot;</span>, <span class="st">&quot;Pr(&gt;|z|)&quot;</span>] <span class="sc">&lt;</span></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a>        <span class="fl">0.01</span>  <span class="co"># test the coefficient of the treatment</span></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a>}</span></code></pre></div>
<p>Example Use</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">find.design</span>(<span class="at">simfun =</span> simfun_glm1, <span class="at">boundaries =</span> <span class="fu">c</span>(<span class="dv">20</span>,</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>    <span class="dv">100</span>), <span class="at">power =</span> <span class="fl">0.95</span>)</span></code></pre></div>
</div>
<div id="specifying-parameters-manually" class="section level2">
<h2>Specifying parameters manually</h2>
<p>We use a logistic regression and generate the data using
hand-specified parameters and the logistic function.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>logistic <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span>x))  <span class="co"># logistic function</span></span></code></pre></div>
<p>We test if the second predictor is significant.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>simfun_glm2 <span class="ot">&lt;-</span> <span class="cf">function</span>(N) {</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>    <span class="co"># generate data</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>    dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">pred1 =</span> <span class="fu">rnorm</span>(N), <span class="at">pred2 =</span> <span class="fu">rnorm</span>(N))</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>    beta <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">1.2</span>, <span class="fl">0.8</span>)  <span class="co"># parameter weights</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>    prob <span class="ot">&lt;-</span> <span class="fu">logistic</span>(<span class="fu">as.matrix</span>(dat) <span class="sc">%*%</span> beta)  <span class="co"># get probability</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>    dat<span class="sc">$</span>criterion <span class="ot">&lt;-</span> <span class="fu">runif</span>(N) <span class="sc">&lt;</span> prob  <span class="co"># draw according to probability</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a>    <span class="co"># test hypothesis</span></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a>    mod <span class="ot">&lt;-</span> <span class="fu">glm</span>(criterion <span class="sc">~</span> pred1 <span class="sc">+</span> pred2, <span class="at">data =</span> dat,</span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a>        <span class="at">family =</span> binomial)  <span class="co"># fit a glm</span></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a>    <span class="fu">summary</span>(mod)<span class="sc">$</span>coefficients[<span class="st">&quot;pred2&quot;</span>, <span class="st">&quot;Pr(&gt;|z|)&quot;</span>] <span class="sc">&lt;</span></span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a>        <span class="fl">0.01</span>  <span class="co"># test the coefficient of the predictor</span></span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a>}</span></code></pre></div>
<p>Example Use</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">find.design</span>(<span class="at">simfun =</span> simfun_glm2, <span class="at">boundaries =</span> <span class="fu">c</span>(<span class="dv">90</span>,</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>    <span class="dv">200</span>), <span class="at">power =</span> <span class="fl">0.95</span>)</span></code></pre></div>
</div>
</div>
<div id="item-response-theory-models" class="section level1">
<h1>Item Response Theory Models</h1>
<p>We first load the necessary packages to fit the utilized models and
generate specific artificial data sets.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="fu">library</span>(mlpwr)</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="fu">library</span>(mirt)</span></code></pre></div>
<p>We use the <code>mirt</code> package to show an example that applies
an item response theory model.</p>
<p>See <code>?simdata</code> for additional options and examples to
generate data with the <code>mirt</code> package.</p>
<div id="testing-a-rasch-against-a-2pl-model" class="section level2">
<h2>Testing a Rasch against a 2PL model</h2>
<p>We first generate data from a 2PL model. Then we want to check
whether the 2PL model actually shows a better fit to the data better
than the simpler Rasch model. We use a likelihood ratio test for this
purpose.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>simfun_irt1 <span class="ot">&lt;-</span> <span class="cf">function</span>(N) {</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>    <span class="co"># generate data</span></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>    dat <span class="ot">&lt;-</span> <span class="fu">simdata</span>(<span class="at">a =</span> <span class="fu">c</span>(<span class="fl">1.04</span>, <span class="fl">1.2</span>, <span class="fl">1.19</span>, <span class="fl">0.61</span>, <span class="fl">1.31</span>,</span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a>        <span class="fl">0.83</span>, <span class="fl">1.46</span>, <span class="fl">1.27</span>, <span class="fl">0.51</span>, <span class="fl">0.81</span>), <span class="at">d =</span> <span class="fu">c</span>(<span class="fl">0.06</span>,</span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a>        <span class="sc">-</span><span class="fl">1.79</span>, <span class="sc">-</span><span class="fl">1.15</span>, <span class="fl">0.88</span>, <span class="sc">-</span><span class="fl">0.2</span>, <span class="sc">-</span><span class="fl">1.87</span>, <span class="fl">1.23</span>, <span class="sc">-</span><span class="fl">0.08</span>,</span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a>        <span class="sc">-</span><span class="fl">0.71</span>, <span class="fl">0.6</span>), <span class="at">N =</span> N, <span class="at">itemtype =</span> <span class="st">&quot;2PL&quot;</span>)  <span class="co"># uses a 2PL model with a and d parameters</span></span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a>    <span class="co"># test hypothesis</span></span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a>    mod <span class="ot">&lt;-</span> <span class="fu">mirt</span>(dat)  <span class="co"># Fit 2PL Model</span></span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a>    constrained <span class="ot">&lt;-</span> <span class="st">&quot;F = 1-4</span></span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a><span class="st">          CONSTRAIN = (1-4, a1)&quot;</span></span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a>    <span class="co"># specifying that the slopes should be kept</span></span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a>    <span class="co"># equal for items 1 to 4</span></span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a>    mod_constrained <span class="ot">&lt;-</span> <span class="fu">mirt</span>(dat, constrained)  <span class="co"># Fit 2PL with equal slopes</span></span>
<span id="cb16-16"><a href="#cb16-16" tabindex="-1"></a></span>
<span id="cb16-17"><a href="#cb16-17" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">anova</span>(mod_constrained, mod)  <span class="co"># perform model comparison</span></span>
<span id="cb16-18"><a href="#cb16-18" tabindex="-1"></a>    res<span class="sc">$</span>p[<span class="dv">2</span>] <span class="sc">&lt;</span> <span class="fl">0.01</span>  <span class="co"># extract significance</span></span>
<span id="cb16-19"><a href="#cb16-19" tabindex="-1"></a>}</span></code></pre></div>
<p>Example Use</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">find.design</span>(<span class="at">simfun =</span> simfun_irt1, <span class="at">boundaries =</span> <span class="fu">c</span>(<span class="dv">100</span>,</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>    <span class="dv">500</span>), <span class="at">power =</span> <span class="fl">0.95</span>, <span class="at">evaluations =</span> <span class="dv">500</span>)</span></code></pre></div>
</div>
<div id="testing-for-dif" class="section level2">
<h2>Testing for DIF</h2>
<p>We check for differential item functioning in one item. Again, we
generate data using the 2PL model, but using different parameters for
two different groups in this case. The parameters for the first item are
different in one group compared to other. We again apply an likelihood
ratio test to test the null hypothesis that all item parameters are
actually equal in both groups.</p>
<p>We optimize for the sizes of the two groups as the two design
parameters. We assume that the second group involves higher costs than
the first.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>costfun_irt2 <span class="ot">&lt;-</span> <span class="cf">function</span>(N1, N2) <span class="dv">5</span> <span class="sc">*</span> N1 <span class="sc">+</span> <span class="dv">7</span> <span class="sc">*</span> N2  <span class="co"># specifying a cost function </span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>simfun_irt2 <span class="ot">&lt;-</span> <span class="cf">function</span>(N1, N2) {</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>    <span class="co"># generate data</span></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>    a1 <span class="ot">&lt;-</span> a2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">1.04</span>, <span class="fl">1.2</span>, <span class="fl">1.19</span>, <span class="fl">0.61</span>, <span class="fl">1.31</span>, <span class="fl">0.83</span>,</span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>        <span class="fl">1.46</span>, <span class="fl">1.27</span>, <span class="fl">0.51</span>, <span class="fl">0.81</span>)  <span class="co"># specifying the slope</span></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a>    d1 <span class="ot">&lt;-</span> d2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.06</span>, <span class="sc">-</span><span class="fl">1.79</span>, <span class="sc">-</span><span class="fl">1.15</span>, <span class="fl">0.88</span>, <span class="sc">-</span><span class="fl">0.2</span>, <span class="sc">-</span><span class="fl">1.87</span>,</span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a>        <span class="fl">1.23</span>, <span class="sc">-</span><span class="fl">0.08</span>, <span class="sc">-</span><span class="fl">0.71</span>, <span class="fl">0.6</span>)  <span class="co"># specifying the difficulty</span></span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a>    a2[<span class="dv">1</span>] <span class="ot">&lt;-</span> a2[<span class="dv">1</span>] <span class="sc">+</span> <span class="fl">0.3</span>  <span class="co"># the slope is different for the first item in group2 </span></span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a>    d2[<span class="dv">1</span>] <span class="ot">&lt;-</span> d2[<span class="dv">1</span>] <span class="sc">+</span> <span class="fl">0.5</span>  <span class="co"># the difficulty is different for the first item in group2 </span></span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a>    dat1 <span class="ot">&lt;-</span> <span class="fu">simdata</span>(<span class="at">a =</span> a1, <span class="at">d =</span> d1, <span class="at">N =</span> N1, <span class="at">itemtype =</span> <span class="st">&quot;2PL&quot;</span>)  <span class="co"># creating artificial data for both groups</span></span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a>    dat2 <span class="ot">&lt;-</span> <span class="fu">simdata</span>(<span class="at">a =</span> a2, <span class="at">d =</span> d2, <span class="at">N =</span> N2, <span class="at">itemtype =</span> <span class="st">&quot;2PL&quot;</span>)</span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a>    dat <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">rbind</span>(dat1, dat2))  <span class="co"># combining the data sets into one object</span></span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a>    group <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;1&quot;</span>, N1), <span class="fu">rep</span>(<span class="st">&quot;2&quot;</span>, N2))  <span class="co"># create a variable that indicates the group membership</span></span>
<span id="cb19-14"><a href="#cb19-14" tabindex="-1"></a></span>
<span id="cb19-15"><a href="#cb19-15" tabindex="-1"></a>    <span class="co"># fit models</span></span>
<span id="cb19-16"><a href="#cb19-16" tabindex="-1"></a>    mod1 <span class="ot">&lt;-</span> <span class="fu">multipleGroup</span>(dat, <span class="dv">1</span>, <span class="at">group =</span> group)  <span class="co"># fit model with different parameters for each group</span></span>
<span id="cb19-17"><a href="#cb19-17" tabindex="-1"></a>    mod2 <span class="ot">&lt;-</span> <span class="fu">multipleGroup</span>(dat, <span class="dv">1</span>, <span class="at">group =</span> group, <span class="at">invariance =</span> <span class="fu">c</span>(<span class="st">&quot;slopes&quot;</span>,</span>
<span id="cb19-18"><a href="#cb19-18" tabindex="-1"></a>        <span class="st">&quot;intercepts&quot;</span>))  <span class="co"># fit model with the same parameters for each group </span></span>
<span id="cb19-19"><a href="#cb19-19" tabindex="-1"></a></span>
<span id="cb19-20"><a href="#cb19-20" tabindex="-1"></a>    <span class="co"># test hypothesis</span></span>
<span id="cb19-21"><a href="#cb19-21" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">anova</span>(mod2, mod1)</span>
<span id="cb19-22"><a href="#cb19-22" tabindex="-1"></a></span>
<span id="cb19-23"><a href="#cb19-23" tabindex="-1"></a>    <span class="co"># extract significance</span></span>
<span id="cb19-24"><a href="#cb19-24" tabindex="-1"></a>    res<span class="sc">$</span>p[<span class="dv">2</span>] <span class="sc">&lt;</span> <span class="fl">0.01</span></span>
<span id="cb19-25"><a href="#cb19-25" tabindex="-1"></a>}</span></code></pre></div>
<p>Example Use</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">find.design</span>(<span class="at">simfun =</span> simfun_irt2, <span class="at">boundaries =</span> <span class="fu">list</span>(<span class="at">N1 =</span> <span class="fu">c</span>(<span class="dv">100</span>,</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>    <span class="dv">700</span>), <span class="at">N2 =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">700</span>)), <span class="at">costfun =</span> costfun_irt2,</span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>    <span class="at">power =</span> <span class="fl">0.95</span>)</span></code></pre></div>
</div>
</div>
<div id="multilevel-models" class="section level1">
<h1>Multilevel Models</h1>
<p>We first load the necessary packages to fit the utilized models and
generate specific artificial data sets.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="fu">library</span>(mlpwr)</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a><span class="fu">library</span>(lmerTest)</span></code></pre></div>
<p>We consider multilevel models using the <code>lme4</code> and
<code>lmerTest</code> packages. We use the <code>glmer</code> function
for model fit and the <code>simulate</code> function to generate data.
For further options for data generation in multilevel models see
<code>?simulate.merMod</code>.</p>
<div id="specifying-parameters-manually-1" class="section level2">
<h2>Specifying parameters manually</h2>
<p>We generate data using manually specified standard deviation of the
random effects and parameter weights. We generate and fit the data
according to a generalized linear mixed effects model with a poisson
distributed criterion variable.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>simfun_multi1 <span class="ot">&lt;-</span> <span class="cf">function</span>(N) {</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a>    <span class="co"># generate data</span></span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a>    params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">theta =</span> <span class="fl">0.5</span>, <span class="at">beta =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="sc">-</span><span class="fl">0.2</span>, <span class="sc">-</span><span class="fl">0.4</span>,</span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a>        <span class="sc">-</span><span class="fl">0.6</span>))  <span class="co"># specifying the standard deviation of the random effects and parameter weights</span></span>
<span id="cb22-6"><a href="#cb22-6" tabindex="-1"></a>    dat <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">herd =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ceiling</span>(N<span class="sc">/</span><span class="dv">4</span>), <span class="at">period =</span> <span class="fu">factor</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>))[<span class="dv">1</span><span class="sc">:</span>N,</span>
<span id="cb22-7"><a href="#cb22-7" tabindex="-1"></a>        ]  <span class="co"># creating predictors</span></span>
<span id="cb22-8"><a href="#cb22-8" tabindex="-1"></a>    dat<span class="sc">$</span>x <span class="ot">&lt;-</span> <span class="fu">simulate</span>(<span class="sc">~</span>period <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> herd), <span class="at">newdata =</span> dat,</span>
<span id="cb22-9"><a href="#cb22-9" tabindex="-1"></a>        <span class="at">family =</span> poisson, <span class="at">newparams =</span> params)[[<span class="dv">1</span>]]  <span class="co"># creating criterion</span></span>
<span id="cb22-10"><a href="#cb22-10" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" tabindex="-1"></a>    <span class="co"># test hypothesis</span></span>
<span id="cb22-12"><a href="#cb22-12" tabindex="-1"></a>    mod <span class="ot">&lt;-</span> <span class="fu">glmer</span>(x <span class="sc">~</span> period <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> herd), <span class="at">data =</span> dat,</span>
<span id="cb22-13"><a href="#cb22-13" tabindex="-1"></a>        <span class="at">family =</span> poisson)  <span class="co"># fit model</span></span>
<span id="cb22-14"><a href="#cb22-14" tabindex="-1"></a>    pvalues <span class="ot">&lt;-</span> <span class="fu">summary</span>(mod)[[<span class="st">&quot;coefficients&quot;</span>]][<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb22-15"><a href="#cb22-15" tabindex="-1"></a>        <span class="st">&quot;Pr(&gt;|z|)&quot;</span>]  <span class="co"># extract p-values</span></span>
<span id="cb22-16"><a href="#cb22-16" tabindex="-1"></a>    <span class="fu">any</span>(pvalues <span class="sc">&lt;</span> <span class="fl">0.01</span>)  <span class="co"># test hypothes that any is significant</span></span>
<span id="cb22-17"><a href="#cb22-17" tabindex="-1"></a>}</span></code></pre></div>
<p>Example Use</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">find.design</span>(<span class="at">simfun =</span> simfun_multi1, <span class="at">boundaries =</span> <span class="fu">c</span>(<span class="dv">100</span>,</span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>    <span class="dv">500</span>), <span class="at">power =</span> <span class="fl">0.95</span>)</span></code></pre></div>
</div>
<div id="using-a-fitted-model-1" class="section level2">
<h2>Using a fitted model</h2>
<p>We generate data from a fitted generalized linear mixed-effects
model. We apply a mixed effects logistic regression in this case. It has
two predictors and a random intercepts for each country.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a>logistic <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span>x))</span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a>N.original <span class="ot">&lt;-</span> <span class="dv">300</span></span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a>n.countries.original <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" tabindex="-1"></a><span class="co"># generate original data</span></span>
<span id="cb24-7"><a href="#cb24-7" tabindex="-1"></a>dat.original <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">country =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>n.countries.original,</span>
<span id="cb24-8"><a href="#cb24-8" tabindex="-1"></a>    <span class="at">length.out =</span> N.original), <span class="at">pred1 =</span> <span class="fu">rnorm</span>(N.original),</span>
<span id="cb24-9"><a href="#cb24-9" tabindex="-1"></a>    <span class="at">pred2 =</span> <span class="fu">rnorm</span>(N.original))  <span class="co"># creating predictors</span></span>
<span id="cb24-10"><a href="#cb24-10" tabindex="-1"></a>country.intercepts <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n.countries.original, <span class="at">sd =</span> <span class="fl">0.5</span>)  <span class="co"># creating random intercepts</span></span>
<span id="cb24-11"><a href="#cb24-11" tabindex="-1"></a>dat.original<span class="sc">$</span>intercepts <span class="ot">&lt;-</span> country.intercepts[dat.original<span class="sc">$</span>country]  <span class="co"># add interecepts to data</span></span>
<span id="cb24-12"><a href="#cb24-12" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.4</span>, <span class="sc">-</span><span class="fl">0.3</span>)  <span class="co"># parameter weights</span></span>
<span id="cb24-13"><a href="#cb24-13" tabindex="-1"></a>prob <span class="ot">&lt;-</span> <span class="fu">logistic</span>(<span class="fu">as.matrix</span>(dat.original[<span class="fu">c</span>(<span class="st">&quot;intercepts&quot;</span>,</span>
<span id="cb24-14"><a href="#cb24-14" tabindex="-1"></a>    <span class="st">&quot;pred1&quot;</span>, <span class="st">&quot;pred2&quot;</span>)]) <span class="sc">%*%</span> <span class="fu">as.matrix</span>(beta))  <span class="co"># get probability</span></span>
<span id="cb24-15"><a href="#cb24-15" tabindex="-1"></a>dat.original<span class="sc">$</span>criterion <span class="ot">&lt;-</span> <span class="fu">runif</span>(N.original) <span class="sc">&lt;</span> prob  <span class="co"># draw according to probability</span></span>
<span id="cb24-16"><a href="#cb24-16" tabindex="-1"></a></span>
<span id="cb24-17"><a href="#cb24-17" tabindex="-1"></a><span class="co"># fit original model to obtain parameters</span></span>
<span id="cb24-18"><a href="#cb24-18" tabindex="-1"></a>mod.original <span class="ot">&lt;-</span> <span class="fu">glmer</span>(criterion <span class="sc">~</span> pred1 <span class="sc">+</span> pred2 <span class="sc">+</span> <span class="dv">0</span> <span class="sc">+</span></span>
<span id="cb24-19"><a href="#cb24-19" tabindex="-1"></a>    (<span class="dv">1</span> <span class="sc">|</span> country), <span class="at">data =</span> dat.original, <span class="at">family =</span> binomial)</span></code></pre></div>
<p>In the simulation function, we generate criterion data using the
original model. Design parameters are the number of participant per
country <code>n</code> and the number of countries
<code>n.countries</code>. We test the hypothesis that the second
predictor is significant.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a>simfun_multi2 <span class="ot">&lt;-</span> <span class="cf">function</span>(n, n.countries) {</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a>    <span class="co"># generate data</span></span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a>    dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">country =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>n.countries,</span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a>        <span class="at">length.out =</span> n <span class="sc">*</span> n.countries), <span class="at">pred1 =</span> <span class="fu">rnorm</span>(n <span class="sc">*</span></span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a>        n.countries), <span class="at">pred2 =</span> <span class="fu">rnorm</span>(n <span class="sc">*</span> n.countries))</span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a>    dat<span class="sc">$</span>criterion <span class="ot">&lt;-</span> <span class="fu">simulate</span>(mod.original, <span class="at">nsim =</span> <span class="dv">1</span>,</span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a>        <span class="at">newdata =</span> dat, <span class="at">allow.new.levels =</span> <span class="cn">TRUE</span>, <span class="at">use.u =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a>        <span class="fu">unlist</span>()  <span class="co"># criterion data from the fitted model</span></span>
<span id="cb25-10"><a href="#cb25-10" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" tabindex="-1"></a>    <span class="co"># test hypothesis</span></span>
<span id="cb25-12"><a href="#cb25-12" tabindex="-1"></a>    mod <span class="ot">&lt;-</span> <span class="fu">glmer</span>(criterion <span class="sc">~</span> pred1 <span class="sc">+</span> pred2 <span class="sc">+</span> <span class="dv">0</span> <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span></span>
<span id="cb25-13"><a href="#cb25-13" tabindex="-1"></a>        country), <span class="at">data =</span> dat, <span class="at">family =</span> binomial)</span>
<span id="cb25-14"><a href="#cb25-14" tabindex="-1"></a>    <span class="fu">summary</span>(mod)[[<span class="st">&quot;coefficients&quot;</span>]][<span class="st">&quot;pred2&quot;</span>, <span class="st">&quot;Pr(&gt;|z|)&quot;</span>] <span class="sc">&lt;</span></span>
<span id="cb25-15"><a href="#cb25-15" tabindex="-1"></a>        <span class="fl">0.01</span>  <span class="co"># check if significant</span></span>
<span id="cb25-16"><a href="#cb25-16" tabindex="-1"></a>}</span></code></pre></div>
<p>As a cost function, we can use</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a>costfun_multi2 <span class="ot">&lt;-</span> <span class="cf">function</span>(n, n.countries) <span class="dv">5</span> <span class="sc">*</span> m <span class="sc">+</span></span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a>    <span class="dv">100</span> <span class="sc">*</span> n.countries</span></code></pre></div>
<p>Example Use</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">find.design</span>(<span class="at">simfun =</span> simfun_multi2, <span class="at">boundaries =</span> <span class="fu">list</span>(<span class="at">n =</span> <span class="fu">c</span>(<span class="dv">10</span>,</span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a>    <span class="dv">40</span>), <span class="at">n.countries =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">20</span>)), <span class="at">costfun =</span> costfun_multi2,</span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a>    <span class="at">power =</span> <span class="fl">0.95</span>)</span></code></pre></div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
